{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { login as loginService, register as registerService, getUser as getUserService } from \"@/services/user\";\nimport { message } from \"antd\";\nconst NAMESPACE = \"login\";\nconst initialState = {\n  token: \"\" || localStorage.getItem(\"token\"),\n  user: {},\n  isLogin: false\n};\nexport const login = createAsyncThunk(`${NAMESPACE}/login`, async (params, state) => {\n  console.log(state);\n  const response = await loginService(params);\n  return response;\n});\nexport const register = createAsyncThunk(`${NAMESPACE}/register`, async params => {\n  const response = await registerService(params);\n  return response;\n});\nexport const getUser = createAsyncThunk(`${NAMESPACE}/user`, async function (params) {\n  const response = await getUserService();\n  return response;\n});\nconst usersSlice = createSlice({\n  name: NAMESPACE,\n  initialState,\n  reducers: {\n    overrideStateProps(state, {\n      payload\n    }) {\n      return { ...state,\n        ...payload\n      };\n    },\n\n    clearToken(state) {\n      localStorage.removeItem(\"token\");\n      state.token = \"\";\n      state.isLogin = false;\n    },\n\n    setToken(state, {\n      payload\n    }) {\n      state.token = payload;\n      localStorage.setItem(\"token\", payload);\n    } // getUser: state => {\n    //   state.username = \"admin\";\n    // },\n    // login: (\n    //   state,\n    //   action: PayloadAction<{ name: string; password: string }>\n    // ) => {\n    //   // state.token = \"sdadsadasdasdsa\";\n    //   localStorage.setItem(\"token\", \"\");\n    // },\n    // register: () => {},\n\n\n  },\n\n  // 处理异步请求结果的reducer\n  extraReducers(builder) {\n    builder.addCase(login.pending, (state, action) => {// state.status = 'loading'\n    }).addCase(login.fulfilled, (state, action) => {\n      const {\n        payload\n      } = action; // console.log(action);\n\n      const {\n        status,\n        data\n      } = payload;\n\n      if (status == 200) {\n        message.success(\"登录成功\");\n        Object.assign(state, data);\n        console.log(state);\n        localStorage.setItem(\"token\", data.token);\n        state.isLogin = true;\n      } else {\n        message.error(\"error\");\n      }\n    }).addCase(login.rejected, (state, action) => {// state.status = 'failed'\n      // state.error = action.error.message\n    }).addCase(register.fulfilled, (state, action) => {});\n  }\n\n}); // export const { login, register } = usersSlice.actions;\n\nexport const {\n  overrideStateProps\n} = usersSlice.actions;\nexport const selectUsername = state => state[NAMESPACE].user.username;\nexport const selectIsLogin = state => state[NAMESPACE].isLogin;\nexport default usersSlice.reducer;","map":{"version":3,"sources":["/Users/renwanjun/Documents/工作/WebProjects/BasicKnowledge/React & Vue/demoes/react-antd-ts/src/reducers/login.ts"],"names":["createSlice","createAsyncThunk","login","loginService","register","registerService","getUser","getUserService","message","NAMESPACE","initialState","token","localStorage","getItem","user","isLogin","params","state","console","log","response","usersSlice","name","reducers","overrideStateProps","payload","clearToken","removeItem","setToken","setItem","extraReducers","builder","addCase","pending","action","fulfilled","status","data","success","Object","assign","error","rejected","actions","selectUsername","username","selectIsLogin","reducer"],"mappings":"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","sourcesContent":["import { createSlice, PayloadAction, createAsyncThunk } from \"@reduxjs/toolkit\";\n\nimport {\n  login as loginService,\n  register as registerService,\n  getUser as getUserService,\n} from \"@/services/user\";\nimport { User } from \"@/interfaces/user\";\nimport { message } from \"antd\";\n\nconst NAMESPACE = \"login\";\nconst initialState = {\n  token: \"\" || localStorage.getItem(\"token\"),\n  user: {},\n  isLogin: false,\n};\n\nexport const login = createAsyncThunk(\n  `${NAMESPACE}/login`,\n  async (params: User, state) => {\n    console.log(state);\n    const response = await loginService(params);\n    return response;\n  }\n);\n\nexport const register = createAsyncThunk(\n  `${NAMESPACE}/register`,\n  async (params: User) => {\n    const response = await registerService(params);\n    return response;\n  }\n);\n\nexport const getUser = createAsyncThunk(\n  `${NAMESPACE}/user`,\n  async function (params) {\n    const response = await getUserService();\n    return response;\n  }\n);\nconst usersSlice = createSlice({\n  name: NAMESPACE,\n  initialState,\n  reducers: {\n    overrideStateProps(state, { payload }: PayloadAction<User>) {\n      return {\n        ...state,\n        ...payload,\n      };\n    },\n    clearToken(state) {\n      localStorage.removeItem(\"token\");\n      state.token = \"\";\n      state.isLogin = false;\n    },\n    setToken(state, { payload }: any) {\n      state.token = payload;\n      localStorage.setItem(\"token\", payload);\n    },\n    // getUser: state => {\n    //   state.username = \"admin\";\n    // },\n    // login: (\n    //   state,\n    //   action: PayloadAction<{ name: string; password: string }>\n    // ) => {\n    //   // state.token = \"sdadsadasdasdsa\";\n    //   localStorage.setItem(\"token\", \"\");\n    // },\n    // register: () => {},\n  },\n  // 处理异步请求结果的reducer\n  extraReducers(builder) {\n    builder\n      .addCase(login.pending, (state, action) => {\n        // state.status = 'loading'\n      })\n      .addCase(login.fulfilled, (state, action) => {\n        const { payload } = action;\n        // console.log(action);\n        const { status, data } = payload;\n        if (status == 200) {\n          message.success(\"登录成功\");\n          Object.assign(state, data);\n          console.log(state);\n          localStorage.setItem(\"token\", data.token);\n          state.isLogin = true;\n        } else {\n          message.error(\"error\");\n        }\n      })\n      .addCase(login.rejected, (state, action) => {\n        // state.status = 'failed'\n        // state.error = action.error.message\n      })\n      .addCase(register.fulfilled, (state, action) => {});\n  },\n});\n\n// export const { login, register } = usersSlice.actions;\nexport const { overrideStateProps } = usersSlice.actions;\nexport const selectUsername = (state: any) => state[NAMESPACE].user.username;\nexport const selectIsLogin = (state: any) => state[NAMESPACE].isLogin;\nexport default usersSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}