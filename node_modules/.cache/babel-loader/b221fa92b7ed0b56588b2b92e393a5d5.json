{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { useHistory } from \"react-router-dom\";\nimport { login as loginService, register as registerService } from \"@/services/user\";\nimport { message } from \"antd\";\nconst NAMESPACE = \"login\";\nconst initialState = {\n  token: \"\",\n  user: \"\"\n};\nconst history = useHistory();\nexport const login = createAsyncThunk(`${NAMESPACE}/login`, async params => {\n  // console.log(params);\n  const response = await loginService(params);\n  return response;\n});\nexport const register = createAsyncThunk(`${NAMESPACE}/register`, async params => {\n  const response = await registerService(params);\n  return response;\n});\nconst usersSlice = createSlice({\n  name: NAMESPACE,\n  initialState,\n  reducers: {\n    overrideStateProps(state, {\n      payload\n    }) {\n      return { ...state,\n        ...payload\n      };\n    } // getUser: state => {\n    //   state.username = \"admin\";\n    // },\n    // login: (\n    //   state,\n    //   action: PayloadAction<{ name: string; password: string }>\n    // ) => {\n    //   // state.token = \"sdadsadasdasdsa\";\n    //   localStorage.setItem(\"token\", \"\");\n    // },\n    // register: () => {},\n\n\n  },\n\n  // 处理异步请求结果的reducer\n  extraReducers(builder) {\n    builder.addCase(login.pending, (state, action) => {// state.status = 'loading'\n    }).addCase(login.fulfilled, (state, action) => {\n      const {\n        payload\n      } = action; // console.log(state);\n      // console.log(state.login);\n\n      const {\n        status,\n        data\n      } = payload;\n\n      if (status == 200) {\n        message.info(\"登录成功\");\n        Object.assign(state, data); // state.login\n\n        localStorage.setItem(\"token\", state.token);\n        history.push(\"/home\"); // console.log(\"token:\", state.token);\n      } else {\n        message.error(\"error\");\n      } // console.log(payload);\n      // state.status = 'succeeded'\n      // // Add any fetched posts to the array\n      // state.posts = state.posts.concat(action.payload)\n\n    }).addCase(login.rejected, (state, action) => {// state.status = 'failed'\n      // state.error = action.error.message\n    }).addCase(register.fulfilled, (state, action) => {});\n  }\n\n}); // export const { login, register } = usersSlice.actions;\n\nexport const {\n  overrideStateProps\n} = usersSlice.actions;\nexport default usersSlice.reducer;","map":{"version":3,"sources":["/Users/renwanjun/Documents/工作/WebProjects/BasicKnowledge/React & Vue/demoes/react-antd-ts/src/reducers/login.ts"],"names":["createSlice","createAsyncThunk","useHistory","login","loginService","register","registerService","message","NAMESPACE","initialState","token","user","history","params","response","usersSlice","name","reducers","overrideStateProps","state","payload","extraReducers","builder","addCase","pending","action","fulfilled","status","data","info","Object","assign","localStorage","setItem","push","error","rejected","actions","reducer"],"mappings":"AAAA,SAASA,WAAT,EAAqCC,gBAArC,QAA6D,kBAA7D;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SACEC,KAAK,IAAIC,YADX,EAEEC,QAAQ,IAAIC,eAFd,QAGO,iBAHP;AAKA,SAASC,OAAT,QAAwB,MAAxB;AACA,MAAMC,SAAS,GAAG,OAAlB;AACA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,KAAK,EAAE,EADY;AAEnBC,EAAAA,IAAI,EAAE;AAFa,CAArB;AAKA,MAAMC,OAAO,GAAGV,UAAU,EAA1B;AACA,OAAO,MAAMC,KAAK,GAAGF,gBAAgB,CAClC,GAAEO,SAAU,QADsB,EAEnC,MAAOK,MAAP,IAAwB;AACtB;AACA,QAAMC,QAAQ,GAAG,MAAMV,YAAY,CAACS,MAAD,CAAnC;AACA,SAAOC,QAAP;AACD,CANkC,CAA9B;AASP,OAAO,MAAMT,QAAQ,GAAGJ,gBAAgB,CACrC,GAAEO,SAAU,WADyB,EAEtC,MAAOK,MAAP,IAAwB;AACtB,QAAMC,QAAQ,GAAG,MAAMR,eAAe,CAACO,MAAD,CAAtC;AACA,SAAOC,QAAP;AACD,CALqC,CAAjC;AAOP,MAAMC,UAAU,GAAGf,WAAW,CAAC;AAC7BgB,EAAAA,IAAI,EAAER,SADuB;AAE7BC,EAAAA,YAF6B;AAG7BQ,EAAAA,QAAQ,EAAE;AACRC,IAAAA,kBAAkB,CAACC,KAAD,EAAQ;AAAEC,MAAAA;AAAF,KAAR,EAA0C;AAC1D,aAAO,EACL,GAAGD,KADE;AAEL,WAAGC;AAFE,OAAP;AAID,KANO,CAOR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAjBQ,GAHmB;;AAsB7B;AACAC,EAAAA,aAAa,CAACC,OAAD,EAAU;AACrBA,IAAAA,OAAO,CACJC,OADH,CACWpB,KAAK,CAACqB,OADjB,EAC0B,CAACL,KAAD,EAAQM,MAAR,KAAmB,CACzC;AACD,KAHH,EAIGF,OAJH,CAIWpB,KAAK,CAACuB,SAJjB,EAI4B,CAACP,KAAD,EAAQM,MAAR,KAAmB;AAC3C,YAAM;AAAEL,QAAAA;AAAF,UAAcK,MAApB,CAD2C,CAE3C;AACA;;AACA,YAAM;AAAEE,QAAAA,MAAF;AAAUC,QAAAA;AAAV,UAAmBR,OAAzB;;AACA,UAAIO,MAAM,IAAI,GAAd,EAAmB;AACjBpB,QAAAA,OAAO,CAACsB,IAAR,CAAa,MAAb;AACAC,QAAAA,MAAM,CAACC,MAAP,CAAcZ,KAAd,EAAqBS,IAArB,EAFiB,CAGjB;;AACAI,QAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8Bd,KAAK,CAACT,KAApC;AACAE,QAAAA,OAAO,CAACsB,IAAR,CAAa,OAAb,EALiB,CAMjB;AACD,OAPD,MAOO;AACL3B,QAAAA,OAAO,CAAC4B,KAAR,CAAc,OAAd;AACD,OAd0C,CAe3C;AACA;AACA;AACA;;AACD,KAvBH,EAwBGZ,OAxBH,CAwBWpB,KAAK,CAACiC,QAxBjB,EAwB2B,CAACjB,KAAD,EAAQM,MAAR,KAAmB,CAC1C;AACA;AACD,KA3BH,EA4BGF,OA5BH,CA4BWlB,QAAQ,CAACqB,SA5BpB,EA4B+B,CAACP,KAAD,EAAQM,MAAR,KAAmB,CAAE,CA5BpD;AA6BD;;AArD4B,CAAD,CAA9B,C,CAwDA;;AACA,OAAO,MAAM;AAAEP,EAAAA;AAAF,IAAyBH,UAAU,CAACsB,OAA1C;AACP,eAAetB,UAAU,CAACuB,OAA1B","sourcesContent":["import { createSlice, PayloadAction, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { useHistory } from \"react-router-dom\";\nimport {\n  login as loginService,\n  register as registerService,\n} from \"@/services/user\";\nimport { User } from \"@/interfaces/user\";\nimport { message } from \"antd\";\nconst NAMESPACE = \"login\";\nconst initialState = {\n  token: \"\",\n  user: \"\",\n};\n\nconst history = useHistory();\nexport const login = createAsyncThunk(\n  `${NAMESPACE}/login`,\n  async (params: User) => {\n    // console.log(params);\n    const response = await loginService(params);\n    return response;\n  }\n);\n\nexport const register = createAsyncThunk(\n  `${NAMESPACE}/register`,\n  async (params: User) => {\n    const response = await registerService(params);\n    return response;\n  }\n);\nconst usersSlice = createSlice({\n  name: NAMESPACE,\n  initialState,\n  reducers: {\n    overrideStateProps(state, { payload }: PayloadAction<User>) {\n      return {\n        ...state,\n        ...payload,\n      };\n    },\n    // getUser: state => {\n    //   state.username = \"admin\";\n    // },\n    // login: (\n    //   state,\n    //   action: PayloadAction<{ name: string; password: string }>\n    // ) => {\n    //   // state.token = \"sdadsadasdasdsa\";\n    //   localStorage.setItem(\"token\", \"\");\n    // },\n    // register: () => {},\n  },\n  // 处理异步请求结果的reducer\n  extraReducers(builder) {\n    builder\n      .addCase(login.pending, (state, action) => {\n        // state.status = 'loading'\n      })\n      .addCase(login.fulfilled, (state, action) => {\n        const { payload } = action;\n        // console.log(state);\n        // console.log(state.login);\n        const { status, data } = payload;\n        if (status == 200) {\n          message.info(\"登录成功\");\n          Object.assign(state, data);\n          // state.login\n          localStorage.setItem(\"token\", state.token);\n          history.push(\"/home\");\n          // console.log(\"token:\", state.token);\n        } else {\n          message.error(\"error\");\n        }\n        // console.log(payload);\n        // state.status = 'succeeded'\n        // // Add any fetched posts to the array\n        // state.posts = state.posts.concat(action.payload)\n      })\n      .addCase(login.rejected, (state, action) => {\n        // state.status = 'failed'\n        // state.error = action.error.message\n      })\n      .addCase(register.fulfilled, (state, action) => {});\n  },\n});\n\n// export const { login, register } = usersSlice.actions;\nexport const { overrideStateProps } = usersSlice.actions;\nexport default usersSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}